---
title: "Introducing edgarWebR"
output: rmarkdown::html_vignette
date: "August 2, 2017"
vignette: >
  %\VignetteIndexEntry{Introducing edgarWebR}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse = T, comment = "#>")
library(edgarWebR)
set.seed(0451)
```

There are plenty of packages for R that allow for fetching and manipulation of
companies' financial data, often fetching that direct from public filings with
the SEC. All of these packages have the goal of getting to the XBRL data,
containing financial statements, typically in annual (10-K) or quarterly (10-Q)
filings.

SEC filings however contain far more information. edgarWebR is the first step
in accessing that data by providing an interface to the SEC EDGAR search tools
and the metadata they provide.

## Current Features

 * Search for companies and mutual funds.
 * List filings for a company or mutual fund.
 * Get all information associated with a particular filing

## Simple Usecase

Using information about filings, we can use edgarWebR to see how long after the
close of a financial period it takes for a company to make a filing. We can
also see how that time has changed. 

### Get Data
First, we'll fetch a bunch of 10-K and 10-Q filings for our given company using
`company_filings()`. To make sure we're going far enough back we'll take a peak
at the tail of our results
```{r}
ticker <- "EA"

filings <- company_filings(ticker, type="10-", count=100)
# Specifying the type provides all forms that start with 10-, so we need to
# manually filter.
filings <- filings[filings$type == "10-K" | filings$type == "10-Q",]
knitr::kable(tail(filings)[,c("filing_date","accession","size", "href")])
```

We're back to 1995 which seems good enough for our purposes, so next we'll get
the filing information for each filing.

```{r cache=TRUE}
# this can take a while - we're fetching ~100 html files!
filings$info <- lapply(filings$href, filing_information) 

# pull relevant fields out of the info
filings$filing_delay <- sapply(filings$info, function(info) {
                                 info$filing_date - info$period_date})
filings$filing_size <- sapply(filings$info, function(info) {info$filing_bytes})
filings$documents <- sapply(filings$info, function(info) {info$documents})
# The library returns these as characters for now
filings$filing_size <- as.numeric(filings$filing_size)
filings$documents <- as.numeric(filings$documents)
```

### Basic Analysis
Now our data is arranged an
```{r fig.width=6}
library(dplyr)
library(ggplot2)

filings <- filings %>% select(type, filing_date, filing_delay, filing_size,
                              documents)

knitr::kable(filings %>% 
             select(-filing_date) %>% # group_by doesn't like date classes
             group_by(type) %>% summarize(
               n=n(),
               `mean delay (days)` = mean(filing_delay),
               `median delay (days)` = median(filing_delay),
               `mean size (KB)` = mean(filing_size / 1024),
               `mean documents (#)` = mean(documents)
               )
             )

ggplot(filings, aes(x = factor(type), y=filing_delay)) +
  geom_violin() + geom_jitter(height = 0, width = 0.1) +
  labs(x = "Filing Date", y = "Filing delay (days)")
```

No surprise, yearly filings (10-K's) are larger and take more time than
quarterly filings (10-K's).

```{r fig.width=6}
ggplot(filings, aes(x = filing_date, y=filing_delay, group=type, color=type)) + 
  geom_point() + geom_line() +
  labs(x = "Filing Type", y = "Filing delay (days)")
```

## Conclusion
While the original example required manually looking up the links to the XBRL
files, limiting extensibility, using edgarWebR we can easily fetch filing
information for any company over any time period with ease.

## More to come
There are plenty of ways in R to get a company's financials, it is all the
